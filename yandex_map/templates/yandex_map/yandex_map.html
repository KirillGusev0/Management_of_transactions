<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Карта компаний</title>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function () {
            ymaps.ready(init);

            function init() {
                var map = new ymaps.Map("map", {
                    center: [55.7558, 37.6176], // Москва по умолчанию
                    zoom: 5
                });

                var points = {{ points|safe }};

                if (points.length === 0) {
                    console.log("Нет данных для отображения на карте");
                    return;
                }

                points.forEach(function (point) {
                    if (point.GEOCODE && point.GEOCODE.length === 2) {
                        var placemark = new ymaps.Placemark(
                            point.GEOCODE,
                            {
                                balloonContent: point.TITLE,
                                hintContent: point.TITLE
                            },
                            {
                                preset: "islands#redDotIcon"
                            }
                        );
                        map.geoObjects.add(placemark);
                    }
                });

                // Автоцентрирование по точкам
                if (points.length > 1) {
                    var bounds = map.geoObjects.getBounds();
                    if (bounds) map.setBounds(bounds, { checkZoomRange: true });
                } else if (points.length === 1) {
                    map.setCenter(points[0].GEOCODE, 14);
                }
            }
        });
    </script>
    <style>
        #map {
            width: 100%;
            height: 500px;
        }
    </style>
</head>
<body>
    <h1>Карта компаний</h1>
    <div id="map"></div>
</body>
</html>
